{% extends 'base.html' %}

{% block title %}Admin — Orders{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Замовлення</h1>

{% if orders %}
  {% for odata in orders %}
    <div class="bg-white p-4 rounded shadow mb-3">
      <div class="flex justify-between">
        <div>
          <div class="font-bold">
            Замовлення #{{ odata['order']['id'] }} — {{ odata['order']['customer_name'] }}
          </div>
          <div class="text-sm text-gray-500">Створено: {{ odata['order']['created_at'] }}</div>
        </div>
        <div>
          <form method="post" class="flex items-center">
            <input type="hidden" name="order_id" value="{{ odata['order']['id'] }}">
            <!-- Якщо використовуєш CSRF token, додай його тут -->
            {# {{ csrf_token() }} #}
            <select name="status" class="border p-1 mr-2">
              <option value="new" {% if odata['order']['status']=='new' %}selected{% endif %}>new</option>
              <option value="processing" {% if odata['order']['status']=='processing' %}selected{% endif %}>processing</option>
              <option value="shipped" {% if odata['order']['status']=='shipped' %}selected{% endif %}>shipped</option>
              <option value="done" {% if odata['order']['status']=='done' %}selected{% endif %}>done</option>
            </select>
            <button class="bg-blue-700 text-white px-2 py-1 rounded">Оновити</button>
          </form>
        </div>
      </div>

      <div class="mt-2">
        <h4 class="font-semibold">Товари:</h4>
        <ul>
          {% set total = 0 %}
          {% for it in odata['items'] %}
            {% set item_total = it['price'] * it['quantity'] %}
            {% set total = total + item_total %}
            <li>{{ it['title'] }} — x{{ it['quantity'] }} — {{ item_total }} USD</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>Замовлень ще немає.</p>
{% endif %}
{% endblock %}
